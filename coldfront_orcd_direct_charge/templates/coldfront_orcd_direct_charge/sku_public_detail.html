{% extends "common/base.html" %}
{% load static %}

{% block title %}
{{ sku.name }} - Rate Details
{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{% url 'coldfront_orcd_direct_charge:current-rates' %}">
        <i class="fas fa-tags"></i> Current Rates
      </a>
    </li>
    <li class="breadcrumb-item active">{{ sku.name }}</li>
  </ol>
</nav>

<div class="row">
  <!-- Main Content -->
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">
          {% if sku.sku_type == 'NODE' %}
            <i class="fas fa-microchip text-primary"></i>
          {% elif sku.sku_type == 'MAINTENANCE' %}
            <i class="fas fa-wrench text-success"></i>
          {% else %}
            <i class="fas fa-tachometer-alt text-info"></i>
          {% endif %}
          {{ sku.name }}
        </h4>
      </div>
      <div class="card-body">
        <!-- Current Rate -->
        <div class="text-center py-4 bg-light rounded mb-4">
          {% if current_rate %}
            <div class="display-4 text-success font-weight-bold">
              ${{ current_rate.rate }}
            </div>
            <div class="text-muted">
              per {% if sku.billing_unit == 'HOURLY' %}hour{% else %}month{% endif %}
            </div>
            <small class="text-muted">
              Effective since {{ current_rate.effective_date|date:"F d, Y" }}
            </small>
          {% else %}
            <div class="text-muted">
              <i class="fas fa-clock fa-2x mb-2"></i>
              <p>Rate information coming soon</p>
            </div>
          {% endif %}
        </div>
        
        <!-- Upcoming Rate Changes -->
        {% if next_rate_change %}
        <div class="alert alert-warning">
          <h6 class="alert-heading">
            <i class="fas fa-exclamation-triangle"></i> Upcoming Rate Change
          </h6>
          <p class="mb-1">
            New rate of <strong>${{ next_rate_change.rate }}</strong>/{% if sku.billing_unit == 'HOURLY' %}hr{% else %}mo{% endif %}
            will be effective starting <strong>{{ next_rate_change.effective_date|date:"F d, Y" }}</strong>.
          </p>
          {% if next_rate_change.notes %}
          <small class="text-muted">{{ next_rate_change.notes }}</small>
          {% endif %}
        </div>
        {% endif %}
        
        {% if upcoming_rates|length > 1 %}
        <div class="alert alert-info">
          <h6 class="alert-heading">
            <i class="fas fa-calendar-alt"></i> Additional Scheduled Changes
          </h6>
          <ul class="mb-0">
            {% for rate in upcoming_rates %}
            {% if not forloop.first %}
            <li>
              ${{ rate.rate }}/{% if sku.billing_unit == 'HOURLY' %}hr{% else %}mo{% endif %} 
              - {{ rate.effective_date|date:"F d, Y" }}
            </li>
            {% endif %}
            {% endfor %}
          </ul>
        </div>
        {% endif %}
        
        <!-- Description -->
        {% if sku.description %}
        <div class="mb-4">
          <h5><i class="fas fa-align-left"></i> Description</h5>
          <p class="text-muted">{{ sku.description }}</p>
        </div>
        {% endif %}
        
        <!-- SKU Information -->
        <div class="mb-4">
          <h5><i class="fas fa-info-circle"></i> SKU Information</h5>
          <table class="table table-sm">
            <tr>
              <th width="40%">SKU Code</th>
              <td><code>{{ sku.sku_code }}</code></td>
            </tr>
            <tr>
              <th>Category</th>
              <td>{{ sku.get_sku_type_display }}</td>
            </tr>
            <tr>
              <th>Billing Unit</th>
              <td>{{ sku.get_billing_unit_display }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Sidebar - Specifications -->
  <div class="col-lg-4">
    {% if formatted_metadata %}
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">
          <i class="fas fa-list-ul"></i> Specifications
        </h5>
      </div>
      <div class="card-body p-0">
        <table class="table table-striped mb-0">
          {% for item in formatted_metadata %}
          <tr>
            <th class="pl-3" width="50%">{{ item.label }}</th>
            <td>
              {% if item.key == 'system_memory_gb' %}
                {{ item.value }} GB
              {% elif item.key == 'gpu_memory_gb' %}
                {{ item.value }} GB
              {% elif item.key == 'local_storage_tb' %}
                {{ item.value }} TB
              {% else %}
                {{ item.value }}
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>
    {% endif %}
    
    <!-- Quick Links -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-link"></i> Quick Links
        </h5>
      </div>
      <div class="card-body">
        <a href="{% url 'coldfront_orcd_direct_charge:current-rates' %}" 
           class="btn btn-outline-primary btn-block mb-2">
          <i class="fas fa-arrow-left"></i> Back to All Rates
        </a>
        {% if sku.sku_type == 'NODE' %}
        <a href="{% url 'coldfront_orcd_direct_charge:renting-calendar' %}" 
           class="btn btn-outline-success btn-block">
          <i class="fas fa-calendar-alt"></i> View Availability
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

