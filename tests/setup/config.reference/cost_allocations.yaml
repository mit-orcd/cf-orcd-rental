version: "1.0"

# Cost allocation configuration for multi-user test setup.
#
# This config drives a two-stage workflow:
#   Stage 1 (04_1_attach_cost_allocations.sh):
#     Creates cost allocations as PENDING, submitted by the user specified
#     in `submitted_by` (project owner or financial admin).
#   Stage 2 (04_2_confirm_cost_allocations.sh):
#     Approves all allocations as the billing manager specified in
#     the `approval` section.
#
# Each project must have at least one cost object, and percentages must
# sum to exactly 100.
#
# Optional date fields per cost allocation entry:
#   created  - Allocation creation date (YYYY-MM-DD or ISO 8601 datetime).
#              Defaults to the current time if omitted.  Applied to both
#              the ProjectCostAllocation and its child ProjectCostObject records.
#   modified - Last modification date (YYYY-MM-DD or ISO 8601 datetime).
#              Defaults to the current time if omitted.
#
# Depends on:
#   - users_multi.yaml  (creates user accounts including orcd_bim)
#   - projects.yaml     (creates the projects referenced here)
#   - members.yaml      (assigns financial admin roles)

defaults:
  status: "PENDING"

approval:
  reviewed_by: "orcd_bim"
  review_notes: "Approved during test setup"

cost_allocations:
  # ── User 0 ─────────────────────────────────────────────────────────
  # _p1: submitted by project owner
  # _p2: submitted by financial admin (orcd_u4, from members.yaml)
  - project: orcd_u0_p1
    submitted_by: "orcd_u0"
    created: "2024-11-01"
    modified: "2025-01-20T10:00:00"
    cost_objects:
      - code: "CO-U0-A"
        percentage: 100
    notes: "Single cost object for user 0, project 1"

  - project: orcd_u0_p2
    submitted_by: "orcd_u4"
    created: "2024-11-01"
    cost_objects:
      - code: "CO-U0-B"
        percentage: 60
      - code: "CO-U0-C"
        percentage: 40
    notes: "Split allocation for user 0, project 2"

  # ── User 1 ─────────────────────────────────────────────────────────
  - project: orcd_u1_p1
    submitted_by: "orcd_u1"
    cost_objects:
      - code: "CO-U1-A"
        percentage: 100

  - project: orcd_u1_p2
    submitted_by: "orcd_u5"
    cost_objects:
      - code: "CO-U1-B"
        percentage: 50
      - code: "CO-U1-C"
        percentage: 50

  # ── User 2 ─────────────────────────────────────────────────────────
  - project: orcd_u2_p1
    submitted_by: "orcd_u2"
    cost_objects:
      - code: "CO-U2-A"
        percentage: 100

  - project: orcd_u2_p2
    submitted_by: "orcd_u6"
    cost_objects:
      - code: "CO-U2-B"
        percentage: 70
      - code: "CO-U2-C"
        percentage: 30

  # ── User 3 ─────────────────────────────────────────────────────────
  - project: orcd_u3_p1
    submitted_by: "orcd_u3"
    cost_objects:
      - code: "CO-U3-A"
        percentage: 100

  - project: orcd_u3_p2
    submitted_by: "orcd_u7"
    cost_objects:
      - code: "CO-U3-B"
        percentage: 40
      - code: "CO-U3-C"
        percentage: 35
      - code: "CO-U3-D"
        percentage: 25
    notes: "Three-way split for user 3, project 2"

  # ── User 4 ─────────────────────────────────────────────────────────
  - project: orcd_u4_p1
    submitted_by: "orcd_u4"
    cost_objects:
      - code: "CO-U4-A"
        percentage: 100

  - project: orcd_u4_p2
    submitted_by: "orcd_u8"
    cost_objects:
      - code: "CO-U4-B"
        percentage: 80
      - code: "CO-U4-C"
        percentage: 20

  # ── User 5 ─────────────────────────────────────────────────────────
  - project: orcd_u5_p1
    submitted_by: "orcd_u5"
    cost_objects:
      - code: "CO-U5-A"
        percentage: 100

  - project: orcd_u5_p2
    submitted_by: "orcd_u9"
    cost_objects:
      - code: "CO-U5-B"
        percentage: 50
      - code: "CO-U5-C"
        percentage: 50

  # ── User 6 ─────────────────────────────────────────────────────────
  - project: orcd_u6_p1
    submitted_by: "orcd_u6"
    cost_objects:
      - code: "CO-U6-A"
        percentage: 100

  - project: orcd_u6_p2
    submitted_by: "orcd_u0"
    cost_objects:
      - code: "CO-U6-B"
        percentage: 60
      - code: "CO-U6-C"
        percentage: 40

  # ── User 7 ─────────────────────────────────────────────────────────
  - project: orcd_u7_p1
    submitted_by: "orcd_u7"
    cost_objects:
      - code: "CO-U7-A"
        percentage: 100

  - project: orcd_u7_p2
    submitted_by: "orcd_u1"
    cost_objects:
      - code: "CO-U7-B"
        percentage: 55
      - code: "CO-U7-C"
        percentage: 45

  # ── User 8 ─────────────────────────────────────────────────────────
  - project: orcd_u8_p1
    submitted_by: "orcd_u8"
    cost_objects:
      - code: "CO-U8-A"
        percentage: 100

  - project: orcd_u8_p2
    submitted_by: "orcd_u2"
    cost_objects:
      - code: "CO-U8-B"
        percentage: 30
      - code: "CO-U8-C"
        percentage: 30
      - code: "CO-U8-D"
        percentage: 40
    notes: "Three-way split for user 8, project 2"

  # ── User 9 ─────────────────────────────────────────────────────────
  - project: orcd_u9_p1
    submitted_by: "orcd_u9"
    cost_objects:
      - code: "CO-U9-A"
        percentage: 100

  - project: orcd_u9_p2
    submitted_by: "orcd_u3"
    cost_objects:
      - code: "CO-U9-B"
        percentage: 75
      - code: "CO-U9-C"
        percentage: 25
